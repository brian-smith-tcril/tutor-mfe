# MFE apps
# {% for app_name, app in iter_mfes() %}
# {{ app_name }}:
#     image: "{{ DOCKER_REGISTRY }}overhangio/openedx-{{ app_name }}-dev:{{ MFE_VERSION }}"
#     ports:
#         - "{{ app["port"] }}:{{ app["port"] }}"
#     stdin_open: true
#     tty: true
#     volumes:
#         - ../plugins/mfe/apps/mfe/webpack.dev-tutor.config.js:/openedx/app/webpack.dev-tutor.config.js:ro
#         {%- for mount in iter_mounts(MOUNTS, app_name) %}
#         - {{ mount }}
#         {%- endfor %}
#     restart: unless-stopped
#     depends_on:
#         - lms
# {% endfor %}

# Web proxy for load balancing and SSL termination
caddy:
  image: {{ DOCKER_IMAGE_CADDY }}
  restart: unless-stopped
  ports:
    - "{{ CADDY_HTTP_PORT }}:80"
    {% if ENABLE_HTTPS and ENABLE_WEB_PROXY %}- "443:443"{% endif %}
  environment:
    default_site_port: "{% if not ENABLE_HTTPS or not ENABLE_WEB_PROXY %}:80{% endif %}"
  volumes:
    - ../apps/caddy/Caddyfile:/etc/caddy/Caddyfile:ro
    {% if ENABLE_HTTPS and ENABLE_WEB_PROXY %}- ../../data/caddy:/data{% endif %}
  {% if not ENABLE_HTTPS %}
  networks:
    default:
      # These aliases are for internal communication between containers when running locally
      # with *.local.overhang.io hostnames.
      aliases:
        - "{{ LMS_HOST }}"
        {{ patch("local-docker-compose-caddy-aliases")|indent(10) }}
  {% endif %}
  # extra_hosts:
  #   - host.docker.internal:host-gateway
mfe:
    image: {{ MFE_DOCKER_IMAGE }}
    restart: unless-stopped
    volumes:
        - ../plugins/mfe/apps/mfe/Caddyfile:/etc/caddy/Caddyfile:ro
    depends_on:
        - lms
